<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="manifest" href="/static/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/static/xiaoba_192.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title data-i18n="app.title">Project N.E.K.O.</title>
    <!-- i18next åŠ è½½å™¨ï¼ˆç»Ÿä¸€å¤„ç† CDN åŠ è½½å’Œåˆå§‹åŒ–ï¼‰ -->
    <script src="/static/i18n-i18next.js"></script>
    <script src="/static/common_dialogs.js"></script>
    <link rel="stylesheet" href="/static/css/index.css">
    <!-- æš—è‰²æ¨¡å¼æ ·å¼ -->
    <link rel="stylesheet" href="/static/css/dark-mode.css">
    <!-- ä¸»é¢˜ç®¡ç†å™¨ï¼ˆå°½æ—©åŠ è½½ä»¥é¿å…é—ªçƒï¼‰ -->
    <script src="/static/theme-manager.js"></script>

    <!-- Driver.js æ–°æ‰‹å¼•å¯¼åº“ (æœ¬åœ°å®ç° - æ— éœ€ CDN) -->
    <script src="/static/libs/driver.min.js"></script>
    <link rel="stylesheet" href="/static/libs/driver.min.css">
    <!-- æ•™ç¨‹æ ·å¼å®šåˆ¶ -->
    <link rel="stylesheet" href="/static/css/tutorial-styles.css">
</head>

<body>

    <!-- æ—§çš„æŒ‰é’®é¢æ¿å·²è¿ç§»åˆ°æµ®åŠ¨æŒ‰é’®ç³»ç»Ÿï¼ˆlive2d.jsï¼‰ï¼Œä¿ç•™éšè—çš„æ—§æŒ‰é’®å…ƒç´ ä¾›åŠŸèƒ½è§¦å‘ä½¿ç”¨ -->
    <div id="sidebar" style="display: none;">
        <div id="sidebarbox">
            <button id="micButton" class="side-btn" data-i18n="voiceControl.startVoice">ğŸ¤ å¼€å§‹è¯­éŸ³</button>
            <button id="muteButton" class="side-btn" disabled data-i18n="voiceControl.rest">â¸ï¸ ä¼‘æ¯ä¸€ä¸‹</button>
            <button id="screenButton" class="side-btn" disabled data-i18n="voiceControl.screenShare">ğŸ–¥ï¸ å±å¹•å…±äº«</button>
            <button id="stopButton" class="side-btn" disabled data-i18n="voiceControl.stopShare">ğŸ›‘ åœæ­¢å…±äº«</button>
            <button id="resetSessionButton" class="side-btn" data-i18n="voiceControl.leave">ğŸ‘‹ è¯·å¥¹ç¦»å¼€</button>
            <button id="returnSessionButton" class="side-btn" data-i18n="voiceControl.return">ğŸ«´ è¯·å¥¹å›æ¥</button>
            <div id="status"></div>
        </div>
    </div>

    <!-- Status æ°”æ³¡æ¡† -->
    <div id="status-toast"></div>
    <div id="chat-container">
        <div id="chat-header">
            <img src="/static/icons/chat_icon.png" data-i18n-alt="chat.title" alt="å¯¹è¯" style="width: 28px; height: 28px; object-fit: contain; margin-right: 6px; vertical-align: middle; image-rendering: -webkit-optimize-contrast; image-rendering: crisp-edges;">
            <span id="chat-title" data-i18n="chat.title">å¯¹è¯</span>
        </div>
        <button id="toggle-chat-btn" data-i18n-title="common.minimize" title="æœ€å°åŒ–"><img
                src='/static/icons/expand_icon_off.png' alt="æœ€å°åŒ–" data-i18n-alt="common.minimize"
                width="32" height="32"
                style="object-fit: cover; pointer-events: none;"></button>
        <div id="chat-tooltip" data-i18n="chat.tooltip">âœ¨ å¯¹è¯åŒº</div>
        <div id="chat-content-wrapper">
            <div id="chatContainer"></div>
        </div>
        <div id="text-input-area">
            <div id="screenshot-thumbnail-container">
                <div id="screenshots-header">
                    <span id="screenshots-title" data-i18n="chat.screenshotsTitle">ğŸ“¸ å¾…å‘é€æˆªå›¾</span><span
                        id="screenshot-count-wrapper"> (<span id="screenshot-count">0</span>)</span>
                    <button id="clear-all-screenshots" data-i18n="chat.clearAll">æ¸…ç©ºå…¨éƒ¨</button>
                </div>
                <div id="screenshots-list">
                    <!-- æˆªå›¾é¡¹å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                </div>
            </div>
            <div id="text-input-row">
                <textarea id="textInputBox" data-i18n-placeholder="chat.textInputPlaceholder"
                    placeholder="æ–‡å­—èŠå¤©æ¨¡å¼...å›è½¦å‘é€ï¼ŒShift+å›è½¦æ¢è¡Œ" tabindex="0"></textarea>
                <div id="button-group">
                    <button id="textSendButton"><img src="/static/icons/send_icon.png" alt=""><span
                            data-i18n="chat.send">å‘é€</span></button>
                    <button id="screenshotButton"><img src="/static/icons/screenshot_icon.png" alt=""><span
                            class="desktop-text" data-i18n="chat.screenshot">æˆªå›¾</span><span class="mobile-text"
                            data-i18n="chat.takePhoto">æ‹ç…§</span></button>
                </div>
            </div>
        </div>
        <!-- å­—å¹•æç¤ºæ¡†ç°åœ¨é€šè¿‡JavaScriptåŠ¨æ€åˆ›å»ºä¸ºç³»ç»Ÿæ¶ˆæ¯ï¼Œä¸å†éœ€è¦é™æ€HTML -->
    </div>
    <!-- å­—å¹•æ˜¾ç¤ºåŒºåŸŸ -->
    <div id="subtitle-display" class="hidden"></div>
    <div id="live2d-container">
        <canvas id="live2d-canvas"></canvas>
    </div>
    <!-- VRMæ¨¡å‹å®¹å™¨ -->
    <div id="vrm-container" style="display: none;">
        <canvas id="vrm-canvas"></canvas>
    </div>

    <!-- Live2D SDK æ ¸å¿ƒåº“ -->
    <script src="/static/libs/live2dcubismcore.min.js"></script>
    <!-- Live2D Cubism JS Framework -->
    <script src="/static/libs/live2d.min.js"></script>
    <script src="/static/libs/pixi.min.js"></script>
    <script src="/static/libs/index.min.js"></script>
    <script src="/static/libs/ogg-opus-decoder.min.js"></script>
    <script src="/static/live2d-core.js"></script>
    <script src="/static/live2d-emotion.js"></script>
    <script src="/static/live2d-model.js"></script>
    <script src="/static/live2d-interaction.js"></script>
    <script src="/static/live2d-ui-buttons.js"></script>
    <script src="/static/live2d-ui-popup.js"></script>
    <script src="/static/live2d-ui-hud.js"></script>
    <script src="/static/live2d-ui-drag.js"></script>
    <script src="/static/live2d-init.js"></script>
    
    <!-- Three.js æ ¸å¿ƒåº“å’Œimportmapï¼ˆç”¨äºES6æ¨¡å—å¯¼å…¥ï¼‰-->
    <script type="importmap">
    {
        "imports": {
            "three": "/static/libs/three.module.js",
            "three/addons/": "/static/libs/three/addons/",
            "@pixiv/three-vrm": "/static/libs/three-vrm.module.min.js",
            "@pixiv/three-vrm-animation": "/static/libs/three-vrm-animation.module.js"
        }
    }
    </script>
    <!-- å°† THREE æŒ‚è½½åˆ° window å¯¹è±¡ï¼Œä»¥ä¾¿éæ¨¡å—è„šæœ¬å¯ä»¥ä½¿ç”¨ -->
    <script type="module">
        import * as THREE from 'three';
        window.THREE = THREE;
        console.log('[Three.js] ES æ¨¡å—å·²åŠ è½½ (ä¸»é¡µ)');
        // å‘é€è‡ªå®šä¹‰äº‹ä»¶ï¼Œé€šçŸ¥å…¶ä»–è„šæœ¬ THREE å·²å°±ç»ª
        window.dispatchEvent(new CustomEvent('three-ready'));
    </script>

    <script src="/static/js/index.js"></script>
    <script src="/static/common_ui.js"></script>
    <script src="/static/vrm-init.js"></script>
    <script src="/static/achievement_manager.js"></script>
    <script src="/static/js/agent_ui_v2.js"></script>
    <script src="/static/ogg-opus-decoder-wrapper.js"></script>
    <script src="/static/app.js"></script>
    <script src="/static/subtitle.js"></script>

    <!-- é€šç”¨æ•™ç¨‹ç®¡ç†å™¨ï¼ˆæ”¯æŒæ‰€æœ‰é¡µé¢ï¼‰ -->
    <script src="/static/tutorial_voice.js"></script>
    <script src="/static/universal-tutorial-manager.js"></script>
    <!-- æ³¨æ„ï¼šåˆå§‹åŒ–ç”± app.js ç»Ÿä¸€å¤„ç†ï¼Œé¿å…é‡å¤åˆå§‹åŒ– -->
</body>

</html>
